version: "3.9"

services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    image: r2d2-backend:latest
    restart: unless-stopped
    ports:
      - "${R2D2_WEB_PORT:-5050}:5050"
    environment:
      R2D2_WEB_HOST: "0.0.0.0"
      R2D2_WEB_PORT: "${R2D2_WEB_PORT:-5050}"
      OPENAI_API_KEY: "${OPENAI_API_KEY:-}"
      ANTHROPIC_API_KEY: "${ANTHROPIC_API_KEY:-}"
    volumes:
      - ./artifacts:/app/artifacts
      - ./data:/app/data

  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    image: r2d2-frontend:latest
    restart: unless-stopped
    depends_on:
      - backend
    ports:
      - "${R2D2_FRONTEND_PORT:-5173}:5173"
    environment:
      VITE_R2D2_API_BASE: "http://backend:5050"
      OPENAI_API_KEY: "${OPENAI_API_KEY:-}"
      ANTHROPIC_API_KEY: "${ANTHROPIC_API_KEY:-}"
